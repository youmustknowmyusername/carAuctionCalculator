<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Auction Calculator</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* (CSS stays the same as ASA 12 baseline â€” unchanged) */
  </style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="brand">ðŸš— Car Auction Calculator</div>
  </div>
</header>

<main class="container grid grid-2" style="margin-top:16px">
  <section class="card">
    <!-- (unchanged form UI) -->
  </section>

  <aside class="card">
    <h2>Result</h2>
    <table>
      <tbody id="resultBody">
        <tr><td class="muted">Nothing to calculate yet.</td></tr>
      </tbody>
      <tfoot>
        <tr><td class="total" id="grandTotal">â€”</td></tr>
      </tfoot>
    </table>
  </aside>
</main>

<script>
  /* Full locations list with prices */
  const LOCATIONS = [
    { name: "AL-BIRMINGHAM", price: 1500 },
    { name: "AL-DOTHAN", price: 0 },
    { name: "AL-HUNTSVILLE", price: 0 },
    { name: "AL-MOBILE", price: 0 },
    { name: "AL-MONTGOMERY", price: 0 },
    { name: "AL-TANNER", price: 0 },
    // ... keep all others same but with price:0 for now
  ];
  const LOCATIONS_SORTED = [...LOCATIONS].sort((a, b) => a.name.localeCompare(b.name));

  // Datasets for other combos
  const YEARS = (() => {
    const current = new Date().getFullYear();
    const out = [];
    for (let y = current; y >= 2013; y--) out.push(String(y));
    return out;
  })();
  const ENGINE_TYPES = ["Gasoline","Hybrid","Diesel","Full electric"];
  const TRANSPORT_TYPES = ["Sedan","Pickup","SUV","Big SUV","Minivan"];

  /* === Location combo updated === */
  function initLocationCombo(){
    const combo   = document.getElementById('locationCombo');
    const display = document.getElementById('locationSearch');
    const panel   = document.getElementById('locationPanel');
    const filter  = document.getElementById('locationFilter');
    const list    = document.getElementById('locationList');
    const textEl  = display.querySelector('.combo-text');

    let currentValue = "";

    function openPanel(){
      panel.hidden = false;
      display.setAttribute('aria-expanded','true');
      filter.value = "";
      renderList(LOCATIONS_SORTED);
      setTimeout(()=>filter.focus(), 0);
    }
    function closePanel(){
      panel.hidden = true;
      display.setAttribute('aria-expanded','false');
    }
    function renderList(items){
      list.innerHTML = items.map(loc => `<li role="option" data-value="${loc.name}">${loc.name}</li>`).join('');
    }

    display.addEventListener('click', ()=>{
      const isOpen = display.getAttribute('aria-expanded') === 'true';
      isOpen ? closePanel() : openPanel();
    });
    display.addEventListener('keydown',(e)=>{
      if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); display.click(); }
      if(e.key === 'Escape'){ closePanel(); }
    });

    filter.addEventListener('input', ()=>{
      const q = filter.value.trim().toLowerCase();
      const items = q ? LOCATIONS_SORTED.filter(l=> l.name.toLowerCase().includes(q)) : LOCATIONS_SORTED;
      renderList(items);
    });

    list.addEventListener('click', (e)=>{
      const li = e.target.closest('li[data-value]');
      if(!li) return;
      currentValue = li.dataset.value;
      display.dataset.value = currentValue;
      textEl.textContent = currentValue || 'Select location...';
      closePanel();
      renderSummary();
    });

    document.addEventListener('click', (e)=>{
      if (!combo.contains(e.target)) closePanel();
    });

    combo.reset = function(){
      currentValue = "";
      display.dataset.value = "";
      textEl.textContent = 'Select location...';
      closePanel();
    }
  }

  function getSelectedLocation(){
    const el = document.getElementById('locationSearch');
    return el?.dataset?.value || "";
  }
  function getLocationPrice(){
    const name = getSelectedLocation();
    const loc = LOCATIONS.find(l => l.name === name);
    return loc ? loc.price : 0;
  }

  function renderSummary(){
    const rows = [
      ['Auction',         prettyAuction(document.getElementById('auction').value)],
      ['Location',        getSelectedLocation()],
      ['Location price',  formatCurrency(getLocationPrice())],
      ['Car price',       formatCurrency(document.getElementById('carPrice').value)],
      ['Production year', getSelectedYear()],
      ['Engine type',     getSelectedEngine()],
      ['Engine, smÂ³',     formatNumber(document.getElementById('engineCC').value)],
      ['Transport type',  getSelectedTransport()]
    ].filter(([, v]) => v);

    const tbody = document.getElementById('resultBody');
    tbody.innerHTML = rows.length === 0
      ? '<tr><td class="muted">Nothing to calculate yet.</td></tr>'
      : rows.map(([k, v]) => `<tr><td><strong>${k}:</strong> ${v}</td></tr>`).join('');
  }

  // Other combos + buttons setup stay same as ASA 12 ...
  // (year, engine, transport, auctionButtons, clearBtn, calcBtn)

</script>
</body>
</html>
